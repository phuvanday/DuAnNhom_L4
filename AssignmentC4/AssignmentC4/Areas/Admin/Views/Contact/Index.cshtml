@model IEnumerable<AssignmentC4.Areas.Admin.Models.Contact>
@{
    ViewData["Title"] = "Quản Lý Liên Hệ";
}

<div class="row mb-3">
    <div class="col-md-6">
        <h2><i class="fas fa-envelope"></i> Quản Lý Liên Hệ</h2>
    </div>
    <div class="col-md-6 text-right">
        <div class="btn-group">
            <a asp-action="Index" asp-route-status="all" class="btn btn-sm @(ViewBag.Status == "all" ? "btn-primary" : "btn-outline-primary")">
                Tất cả
            </a>
            <a asp-action="Index" asp-route-status="New" class="btn btn-sm @(ViewBag.Status == "New" ? "btn-warning" : "btn-outline-warning")">
                Mới
            </a>
            <a asp-action="Index" asp-route-status="Read" class="btn btn-sm @(ViewBag.Status == "Read" ? "btn-info" : "btn-outline-info")">
                Đã đọc
            </a>
            <a asp-action="Index" asp-route-status="Replied" class="btn btn-sm @(ViewBag.Status == "Replied" ? "btn-success" : "btn-outline-success")">
                Đã trả lời
            </a>
        </div>
    </div>
</div>

<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="thead-light">
                    <tr>
                        <th style="width: 50px">ID</th>
                        <th>Tên</th>
                        <th>Email</th>
                        <th>Điện Thoại</th>
                        <th>Tiêu Đề</th>
                        <th style="width: 100px">Trạng Thái</th>
                        <th style="width: 120px">Ngày Gửi</th>
                        <th style="width: 100px">Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var item in Model)
                        {
                            <tr class="@(item.Status == "New" ? "table-warning" : "")">
                                <td>@item.Id</td>
                                <td>@item.Name</td>
                                <td>@item.Email</td>
                                <td>@item.Phone</td>
                                <td>@item.Subject</td>
                                <td>
                                    @switch (item.Status)
                                    {
                                        case "New":
                                            <span class="badge badge-warning">Mới</span>
                                            break;
                                        case "Read":
                                            <span class="badge badge-info">Đã đọc</span>
                                            break;
                                        case "Replied":
                                            <span class="badge badge-success">Đã trả lời</span>
                                            break;
                                    }
                                </td>
                                <td>@item.CreatedDate.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#viewModal@(item.Id)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    @if (item.Status != "Replied")
                                    {
                                        <form asp-action="MarkAsRead" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@item.Id" />
                                            <button type="submit" class="btn btn-sm btn-success">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                    }
                                </td>
                            </tr>

                            <!-- Modal View Detail -->
                            <div class="modal fade" id="viewModal@(item.Id)" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Chi Tiết Liên Hệ</h5>
                                            <button type="button" class="close" data-dismiss="modal">
                                                <span>&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <dl class="row">
                                                <dt class="col-sm-3">Tên:</dt>
                                                <dd class="col-sm-9">@item.Name</dd>

                                                <dt class="col-sm-3">Email:</dt>
                                                <dd class="col-sm-9">@item.Email</dd>

                                                <dt class="col-sm-3">Điện thoại:</dt>
                                                <dd class="col-sm-9">@item.Phone</dd>

                                                <dt class="col-sm-3">Tiêu đề:</dt>
                                                <dd class="col-sm-9">@item.Subject</dd>

                                                <dt class="col-sm-3">Nội dung:</dt>
                                                <dd class="col-sm-9">@item.Message</dd>
                                            </dl>

                                            @if (!string.IsNullOrEmpty(item.AdminReply))
                                            {
                                                <hr>
                                                <h6>Phản hồi của Admin:</h6>
                                                <p class="text-success">@item.AdminReply</p>
                                            }
                                            else
                                            {
                                                <hr>
                                                <form asp-action="Reply" method="post">
                                                    <input type="hidden" name="id" value="@item.Id" />
                                                    <div class="form-group">
                                                        <label>Phản hồi:</label>
                                                        <textarea name="message" class="form-control" rows="4" required></textarea>
                                                    </div>
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-paper-plane"></i> Gửi Phản Hồi
                                                    </button>
                                                </form>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="8" class="text-center">Chưa có liên hệ nào</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
